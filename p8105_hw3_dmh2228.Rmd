---
title: "P8105 Homework 3"
author: "Diana Hernandez"
date: "2023-10-14"
output: github_document
---

# Load libraries and settings

```{r}
library(tidyverse)

library(p8105.datasets)

library(patchwork)

knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

theme_set(theme_minimal())

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

# Problem 1: Instacart

```{r}
data("instacart")
```

There are a total of `r length(instacart)` variables. There are `r nrow(instacart)` rows and `r ncol(instacart)` columns. Examples of key variables include order ID, product ID, user ID, product name, aisle ID, aisle number, etc. 

```{r}
instacart_df = 
  instacart
  
instacart_df |>
  group_by(aisle) |>
  summarize(n_obs = n())
```

There are 134 aisles. The aisles that the most items are ordered from are: fresh vegetables, fresh fruits, and packaged vegetable fruits. 

```{r}
instacart_plot = 
instacart_df |>
  filter(n() >= 10000)
  ggplot(instacart_df, aes(x = aisle_id)) + 
  geom_bar() +
  labs(
    title = "Orders by aisle",
    x = "Aisles by ID",
    y = "Number of orders")
```

```{r}
instacart_table =
instacart_df |> 
  filter(aisle == c("baking ingredients", "dog food care", "packaged vegetables fruits")) |>
  group_by(aisle, product_name) |> 
  summarize(n_obs = n()) 
```

# Problem 2: BRFSS

```{r}
data("brfss_smart2010")
```

# Data wrangling of brfsss_smart2010

```{r}
brfss_smart2010_df = 
  brfss_smart2010 |>
  janitor::clean_names() |>
  select(-location_id) |>
  filter(topic == "Overall Health") |>
  mutate(
    response = factor(response, levels = c("Poor", "Fair", "Good", "Very Good", "Excellent"))
  ) |>
  arrange(response)
```

There are a total of `r length(brfss_smart2010_df)` variables. There are `r nrow(brfss_smart2010_df)` rows and `r ncol(brfss_smart2010_df)` columns.

```{r}
locations_2002 = 
brfss_smart2010_df |>
  select(year, locationabbr, locationdesc) |>
  filter(year==2002) |>
  group_by(locationabbr, locationdesc) 

locations_2010 = 
  brfss_smart2010_df |>
  select(year, locationabbr, locationdesc) |>
  filter(year==2010) |>
  group_by(locationabbr, locationdesc) 
```

```{r}
excellent_data =
  brfss_smart2010_df |>
  filter(response == "Excellent") |>
  select(year, locationabbr, data_value) |>
  group_by(locationabbr, year) |>
  mutate(
    mean_data_value = mean(data_value, na.rm = TRUE)
  ) 

ggplot(excellent_data, aes(x = year, y = mean_data_value, group = locationabbr, color = locationabbr)) +
geom_line() +
labs(
  title = "Average data value across locations in state",
  x = "Year",
  y = "Average data value",
  color = "Location")
```

The average data value fluctuates by year for most states.

```{r}
ny2006_data =
  brfss_smart2010_df |>
  filter(locationabbr == "NY", year == "2006")

ny2006_plot =
ggplot(ny2006_data, aes(x = response, y = data_value, color = locationdesc)) +
  geom_point()

ny2010_data =
  brfss_smart2010_df |>
  filter(locationabbr == "NY", year == "2010")

ny2010_plot =
ggplot(ny2010_data, aes(x = response, y = data_value, color = locationdesc)) +
  geom_point()

ny2006_plot + ny2010_plot
```

2006 and 2010 have a similar distribution of `data_value` for responses (“Poor” to “Excellent”) among locations in NY State.

# Problem 3: NHANES

# Data wrangling of accelerometer data

```{r}
nhanes_accel_data = 
  read_csv("./nhanes_data/nhanes_accel.csv") |>
  janitor::clean_names() |>
  pivot_longer(
    !seqn,
    names_to = "minute",
    names_prefix = "min",
    values_to = "mims"
  )
```

# Data wrangling of demographic data

```{r}
nhanes_covar_data = 
  read_csv("./nhanes_data/nhanes_covar.csv", skip = 4) |>
  janitor::clean_names() |>
  mutate(
    sex =
      case_match(
        sex,
        1 ~ "Male",
        2 ~ "Female"
        ),
    sex = as.factor(sex),
    education =
      case_match(
        education,
        1 ~ "Level 1",
        2 ~ "Level 2",
        3 ~ "Level 3"
      ),
    education = as.factor(education)
  ) 
```

# Data merging

```{r}
final_nhanes_data =
  full_join(nhanes_covar_data, nhanes_accel_data) |>
  filter(age > 20) |>
  drop_na(sex, age, bmi, education) |>
  mutate(
    sex = as.factor(sex),
    education = as.factor(education)
  )
```

```{r}
sex_education_table =
  final_nhanes_data |>
  select(sex, education) |>
  group_by(sex, education) |>
  summarize(count = n())

sex_education_table

sex_education_plot =
  ggplot(final_nhanes_data, aes(x = education, fill = sex)) +     
  geom_bar(position = position_dodge(), alpha = 0.75) +
  labs(
    title = "Education level by sex",
    x = "Levels of education",
    y = "Number of participants"
  )

sex_education_plot
```

More female participants are in the 3rd level of education compared to male participants. However, more female participants are in the 1st level of education compared to male participants as well. There are more male participants in the 2nd level of education compared to female participants.

```{r}
nhanes_total_activity_data =
  final_nhanes_data |>
  group_by(seqn) |>
  mutate(
    total_activity = sum(mims)
    )

nhanes_total_activity_plot =
  ggplot(nhanes_total_activity_data, aes(x = age, y = total_activity, color = sex)) +
  geom_point(alpha = .5) +
  geom_smooth(se = FALSE) +
  facet_grid(. ~ education) +
  labs(
     title = "Total activity by age and sex comparing education levels",
    x = "Age (in years)",
    y = "Total activity (in mims)"
  )

nhanes_total_activity_plot
```

Younger female participants are more active across all levels of education. Older men are more active in the first level of education, but less active in both the second and third level of education. Older women with the highest education are most active among all those with the highest level of education. In general, activity does fluctuate by year. 